<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feeding — Calculator</title>
  <link rel="stylesheet" href="/p-feeding/assets/site.css" />
</head>
<body>
  <header class="navbar">
    <div class="container">
      <nav class="nav-links">
        <a href="/p-feeding/index.html" data-i18n="nav.home"></a>
        <a href="/p-feeding/feeding.html" data-i18n="nav.calculator"></a>
        <a href="/p-feeding/cards/transition-7.html" data-i18n="nav.transition7"></a>
        <a href="/p-feeding/feedback.html" data-i18n="nav.feedback"></a>
      </nav>
      <select id="lang-select" aria-label="Language"></select>
    </div>
  </header>

  <main class="page">
    <h1 data-i18n="feeding.title"></h1>
    <p class="sub" data-i18n="legal.note"></p>

    <form class="panel grid-2" id="calc-form" onsubmit="return false;">
      <div class="field">
        <label for="pet" data-i18n="feeding.pet.label"></label>
        <select id="pet">
          <option value="dog" data-i18n="feeding.pet.dog"></option>
          <option value="cat" data-i18n="feeding.pet.cat"></option>
        </select>
      </div>

      <div class="field">
        <label for="weight" data-i18n="feeding.weight.label"></label>
        <input id="weight" type="number" min="0" step="0.01"
               data-i18n-placeholder="feeding.weight.placeholder" />
      </div>

      <div class="field">
        <label for="unit" data-i18n="feeding.unit.label"></label>
        <select id="unit">
          <option value="kg" data-i18n="feeding.unit.kg"></option>
          <option value="lb" data-i18n="feeding.unit.lb"></option>
        </select>
      </div>

      <div class="field">
        <label for="activity" data-i18n="feeding.activity.label"></label>
        <select id="activity">
          <option value="resting" data-i18n="feeding.activity.resting"></option>
          <option value="normal" data-i18n="feeding.activity.normal"></option>
          <option value="active" data-i18n="feeding.activity.active"></option>
        </select>
      </div>

      <div class="field">
        <label for="kcal" data-i18n="feeding.kcal_per_cup.label"></label>
        <input id="kcal" type="number" min="1" step="1" value="350" />
      </div>

      <div class="field">
        <label for="grams" data-i18n="feeding.grams_per_cup.label"></label>
        <input id="grams" type="number" min="1" step="1" value="110" />
      </div>

      <div class="actions">
        <button id="btn-calc" class="btn" type="button" data-i18n="feeding.btn.calc"></button>
        <a id="to-home" class="btn ghost" href="/p-feeding/index.html" data-i18n="feeding.btn.back"></a>
      </div>
    </form>

    <section class="panel result">
      <h2 data-i18n="feeding.result.title"></h2>
      <div id="result-box" class="mono">—</div>
    </section>
  </main>

  <footer class="foot">© Pet Scan</footer>

  <script src="/p-feeding/assets/i18n.js" defer></script>
  <script src="/p-feeding/assets/app.js" defer></script>

  <!-- 只有本页需要的轻量计算逻辑 -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const $ = (id) => document.getElementById(id);
      const weight = $('weight');
      const unit = $('unit');
      const activity = $('activity');
      const kcal = $('kcal');
      const grams = $('grams');
      const resultBox = $('result-box');

      function toNumber(v, def = 0) {
        const n = Number(v);
        return Number.isFinite(n) ? n : def;
      }

      function calc() {
        const w = toNumber(weight.value);
        if (w <= 0) { resultBox.textContent = '—'; return; }

        let kg = w;
        if (unit.value === 'lb') kg = w * 0.45359237;

        // RER & MER
        const RER = 70 * Math.pow(kg, 0.75);
        const factor = activity.value === 'resting' ? 1.0
                      : activity.value === 'normal' ? 1.6
                      : 2.0;
        const MER = RER * factor;

        const kcalPerCup = Math.max(1, toNumber(kcal.value, 350));
        const gramsPerCup = Math.max(1, toNumber(grams.value, 110));
        const cups = MER / kcalPerCup;
        const gramsDay = cups * gramsPerCup;

        const lang = (window.appGetLang && appGetLang()) || 'en';
        const t = (k) => (window.I18N && I18N.t(k, lang)) || k;

        const fmt = (n) => n.toFixed(2).replace(/\.00$/, '');
        resultBox.innerHTML =
          `${t('feeding.result.rer')}: ${fmt(RER)} kcal/day<br>` +
          `${t('feeding.result.mer')}: ${fmt(MER)} kcal/day<br><br>` +
          `${t('feeding.result.daily')}: <b>${fmt(cups)}</b> ${t('feeding.result.cups')} ` +
          `≈ <b>${fmt(gramsDay)}</b> g`;
      }

      document.getElementById('btn-calc').addEventListener('click', calc);
    });
  </script>
</body>
</html>
