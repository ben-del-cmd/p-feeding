<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pet Scan — Feeding Calculator</title>
  <meta name="description" content="RER/MER → kcal/day → cups/grams with activity factor. Informational only. Not medical advice.">

  <!-- HOTFIX-01：修复 ?%3F / ?%253F -->
  <script>(function(){var q=location.search;if(/^\?%253F/i.test(q))location.replace(location.pathname+'?'+q.replace(/^\?%253F/i,''));else if(/^\?%3F/i.test(q))location.replace(location.pathname+'?'+q.replace(/^\?%3F/i,''));})();</script>

  <!-- 英文优先 -->
  <script>(function(){var u=new URL(location.href);var cur=u.searchParams.get('lang')||localStorage.getItem('lang')||'en';if(!u.searchParams.get('lang')){u.searchParams.set('lang',cur);history.replaceState(null,'',u.toString());}document.documentElement.lang=cur;localStorage.setItem('lang',cur);})();</script>

  <link rel="stylesheet" href="assets/site.css?v=20250923" />

  <!-- Plausible（域名按实际仓库） -->
  <script>(function(){var DOMAIN='ben-del-cmd.github.io';window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)};if(!document.querySelector('script[data-plausible][data-domain="'+DOMAIN+'"]')){var s=document.createElement('script');s.defer=true;s.src='https://plausible.io/js/script.js';s.setAttribute('data-domain',DOMAIN);s.setAttribute('data-plausible','');document.head.appendChild(s);}})();</script>

  <script src="i18n.js?v=20250923" defer></script>
  <script src="assets/js/events.js?v=20250923" defer></script>

  <!-- 链接热补丁（去 %3F + 去重复 lang） -->
  <script>
  (function(){
    function curLang(){try{const u=new URL(location.href);return u.searchParams.get('lang')||localStorage.getItem('lang')||'en'}catch(e){return'en'}}
    function normalize(u,l){if(/^\?%3F/i.test(u.search))u.search='?'+u.search.replace(/^\?%3F/i,'');if(/^\?%253F/i.test(u.search))u.search='?'+u.search.replace(/^\?%253F/i,'');u.searchParams.delete('lang');u.searchParams.set('lang',l||'en');return u.pathname+u.search+u.hash}
    function rewriteAll(){var l=curLang();document.querySelectorAll('a[href]').forEach(function(a){var h=a.getAttribute('href');if(!h||h.startsWith('#')||/^https?:\/\//i.test(h))return;var u=new URL(h,location.href);a.setAttribute('href',normalize(u,l));});}
    document.addEventListener('DOMContentLoaded',rewriteAll);
    document.addEventListener('click',function(ev){var a=ev.target&&ev.target.closest&&ev.target.closest('a[href]');if(!a)return;var h=a.getAttribute('href');if(!h||h.startsWith('#')||/^https?:\/\//i.test(h))return;var u=new URL(h,location.href),qs=u.searchParams.toString();var dup=/(^|&)lang=/.test(qs)&&(qs.match(/(^|&)lang=/g)||[]).length>1;var bad=/^\?%3F/i.test(u.search)||/^\?%253F/i.test(u.search);if(dup||bad){ev.preventDefault();location.href=normalize(u,curLang());}},true);
  })();
  </script>
</head>

<!-- 仅用于样式作用域：让“收窄规则”只影响本页 -->
<body class="page-feeding">
<header>
  <nav aria-label="Main">
    <a href="index.html" data-i18n="nav.home">Home</a>
    <a href="feeding.html" data-i18n="nav.calculator">Calculator</a>
    <a href="feedback.html" data-i18n="nav.feedback">Feedback</a>
  </nav>
  <div id="lang-slot" style="display:none"></div>
</header>

<main>
  <h1 data-i18n="feeding.title">Feeding Calculator</h1>
  <p class="note" data-i18n="legal.info_boundary">Informational only. Not medical advice.</p>

  <!-- 加了 calculator 类，配合 CSS 把这张卡片变窄且居中 -->
  <div class="card calculator">
    <label for="pet-type" data-i18n="feeding.pet_type.label">Pet</label>
    <select id="pet-type">
      <option value="dog" data-i18n="feeding.pet_type.dog">Dog</option>
      <option value="cat" data-i18n="feeding.pet_type.cat">Cat</option>
    </select>

    <label for="weight" data-i18n="feeding.weight.label">Weight</label>
    <input id="weight" type="number" min="0" step="0.1" placeholder="Enter weight" data-i18n-placeholder="feeding.weight.placeholder" />

    <label for="unit" data-i18n="feeding.unit.label">Unit</label>
    <select id="unit">
      <option value="kg" data-i18n="feeding.unit.kg">kg</option>
      <option value="lb" data-i18n="feeding.unit.lb">lb</option>
    </select>

    <label for="activity" data-i18n="feeding.activity.label">Activity</label>
    <select id="activity">
      <option value="1.0" data-i18n="feeding.activity.resting">Resting</option>
      <option value="1.4" data-i18n="feeding.activity.normal">Normal</option>
      <option value="2.0" data-i18n="feeding.activity.active">Active</option>
    </select>

    <label for="kcal-per-cup" data-i18n="feeding.kcal_per_cup.label">kcal per cup</label>
    <input id="kcal-per-cup" type="number" min="1" step="1" value="350" placeholder="e.g., 350" data-i18n-placeholder="feeding.kcal_per_cup.placeholder" />

    <label for="grams-per-cup" data-i18n="feeding.grams_per_cup.label">grams per cup</label>
    <input id="grams-per-cup" type="number" min="1" step="1" value="110" placeholder="e.g., 110" data-i18n-placeholder="feeding.grams_per_cup.placeholder" />

    <p class="note" id="formula-note" data-i18n="feeding.formula.note">RER = 70 × weight^0.75; MER = RER × activity.</p>

    <button id="btn-calc" class="btn" data-i18n="feeding.calculate">Calculate</button>

    <div id="result" class="card" hidden>
      <h2 data-i18n="feeding.result.title">Result</h2>
      <p><span data-i18n="feeding.result.kcal">Daily energy:</span> <strong id="out-kcal">—</strong> kcal</p>
      <p><span data-i18n="feeding.result.cups">Cups/day:</span> <strong id="out-cups">—</strong></p>
      <p><span data-i18n="feeding.result.grams">Grams/day:</span> <strong id="out-grams">—</strong></p>
      <p class="note" data-i18n="feeding.result.tip">Split into 2–3 meals. Adjust with weight trend.</p>
      <p><a class="btn" href="cards/transition-7.html" data-i18n="feeding.result.view_transition_card">View 7-Day Transition Card</a></p>
    </div>
  </div>
</main>

<footer>
  <p class="note" data-i18n="footer.disclaimer">For diet/medical questions, consult your veterinarian.</p>
</footer>

<!-- 计算逻辑 + 埋点 -->
<script>
(function(){
  function pow075(x){return Math.pow(x,0.75)}
  function toKg(w,u){return u==='lb'?w*0.45359237:w}
  function lang(){try{var u=new URL(location.href);return u.searchParams.get('lang')||localStorage.getItem('lang')||'en'}catch(e){return'en'}}
  function page(n,p){try{if(window.ps&&ps.events&&ps.events.page)ps.events.page(n,p);else plausible('pageview',{props:Object.assign({page_name:n,lang:lang()},p||{})})}catch(e){}}
  function evt(n,p){try{if(window.ps&&ps.events&&ps.events.event)ps.events.event(n,p);else plausible(n,{props:Object.assign({lang:lang()},p||{})})}catch(e){}}
  document.addEventListener('DOMContentLoaded',function(){
    page('visit_feeding_page');
    document.getElementById('btn-calc').addEventListener('click',function(){
      var w=parseFloat(document.getElementById('weight').value||'0');
      var unit=document.getElementById('unit').value;
      var kpc=parseFloat(document.getElementById('kcal-per-cup').value||'0');
      var gpc=parseFloat(document.getElementById('grams-per-cup').value||'0');
      var act=parseFloat(document.getElementById('activity').value||'1.0');
      if(!w||!kpc||!gpc){return}
      var kg=toKg(w,unit);var rer=70*pow075(kg);var mer=rer*act;var cups=mer/kpc;var grams=cups*gpc;
      document.getElementById('out-kcal').textContent=Math.round(mer);
      document.getElementById('out-cups').textContent=(Math.round(cups*100)/100).toFixed(2);
      document.getElementById('out-grams').textContent=Math.round(grams);
      document.getElementById('result').hidden=false;evt('calc_click');
    });
  });
})();
</script>
</body>
</html>
