<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pet Scan — Feeding Calculator</title>
  <meta name="description" content="RER/MER → kcal/day → cups/grams with activity factor. Informational only. Not medical advice.">
  <link rel="stylesheet" href="../assets/site.css?v=20250920b">
  <script defer data-domain="" src="https://plausible.io/js/script.js"></script>
  <script>
    (function () {
      var u = new URL(location.href);
      var cur = u.searchParams.get('lang') || localStorage.getItem('lang') || 'en';
      if (!u.searchParams.get('lang')) { u.searchParams.set('lang', cur); history.replaceState(null,'',u.toString()); }
      document.documentElement.setAttribute('lang', cur);
      localStorage.setItem('lang', cur);
    })();
  </script>
  <script src="../i18n.js" defer></script>
  <script src="../assets/js/events.js" defer></script>
  <style>
    :root { --maxw: 960px; }
    body { margin:0; line-height:1.45; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; }
    header, main, footer { max-width: var(--maxw); margin: 0 auto; padding: 16px; }
    nav a { margin-right: 12px; text-decoration: none; }
    .btn { padding: 10px 14px; border-radius: 10px; border: 1px solid #ddd; display: inline-block; }
    .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; }
    .note { font-size: 12px; opacity: .8; }
    label { display:block; margin-top:10px; }
    input, select, button { padding:8px; border:1px solid #ccc; border-radius:8px; }
  </style>
</head>
<body>
<header>
  <nav aria-label="Main">
    <a href="../index.html" data-i18n="nav.home">Home</a>
    <a href="feeding.html" data-i18n="nav.calculator">Calculator</a>
    <a href="../feedback.html" data-i18n="nav.feedback">Feedback</a>
  </nav>
</header>

<main>
  <h1 id="feeding-title" data-i18n="feeding.title">Feeding Calculator</h1>
  <p class="note" data-i18n="legal.info_boundary">Informational only. Not medical advice.</p>

  <div class="card">
    <label for="pet-type" data-i18n="feeding.pet_type.label">Pet</label>
    <select id="pet-type" aria-label="Pet">
      <option value="dog" data-i18n="feeding.pet_type.dog">Dog</option>
      <option value="cat" data-i18n="feeding.pet_type.cat">Cat</option>
    </select>

    <label for="weight" data-i18n="feeding.weight.label">Weight</label>
    <input id="weight" type="number" min="0" step="0.1" placeholder="Enter weight" data-i18n-placeholder="feeding.weight.placeholder">

    <label for="unit" data-i18n="feeding.unit.label">Unit</label>
    <select id="unit" aria-label="Unit">
      <option value="kg" data-i18n="feeding.unit.kg">kg</option>
      <option value="lb" data-i18n="feeding.unit.lb">lb</option>
    </select>

    <label for="activity" data-i18n="feeding.activity.label">Activity</label>
    <select id="activity" aria-label="Activity">
      <option value="1.0" data-i18n="feeding.activity.resting">Resting</option>
      <option value="1.4" data-i18n="feeding.activity.normal">Normal</option>
      <option value="2.0" data-i18n="feeding.activity.active">Active</option>
    </select>

    <label for="kcal-per-cup" data-i18n="feeding.kcal_per_cup.label">kcal per cup</label>
    <input id="kcal-per-cup" type="number" min="1" step="1" value="350" placeholder="e.g., 350" data-i18n-placeholder="feeding.kcal_per_cup.placeholder">

    <label for="grams-per-cup" data-i18n="feeding.grams_per_cup.label">grams per cup</label>
    <input id="grams-per-cup" type="number" min="1" step="1" value="110" placeholder="e.g., 110" data-i18n-placeholder="feeding.grams_per_cup.placeholder">

    <p class="note" id="formula-note" data-i18n="feeding.formula.note">RER = 70 × weight^0.75; MER = RER × activity.</p>

    <button id="btn-calc" class="btn" data-i18n="feeding.calculate">Calculate</button>

    <div id="result" hidden>
      <h2 data-i18n="feeding.result.title">Result</h2>
      <p><span data-i18n="feeding.result.kcal">Daily energy:</span> <strong id="out-kcal">—</strong> kcal</p>
      <p><span data-i18n="feeding.result.cups">Cups/day:</span> <strong id="out-cups">—</strong></p>
      <p><span data-i18n="feeding.result.grams">Grams/day:</span> <strong id="out-grams">—</strong></p>
      <p class="note" data-i18n="feeding.result.tip">Split into 2–3 meals. Adjust with weight trend.</p>
      <p><a class="btn" href="../cards/transition-7.html" data-i18n="feeding.result.view_transition_card">View 7-Day Transition Card</a></p>
    </div>
  </div>
</main>

<footer>
  <p class="note" id="footer-disclaimer" data-i18n="footer.disclaimer">For diet/medical questions, consult your veterinarian.</p>
</footer>

<script>
  (function () {
    function curLang() {
      try { var u=new URL(location.href); return u.searchParams.get('lang') || localStorage.getItem('lang') || 'en'; }
      catch(e){ return 'en'; }
    }
    // 保留 ?lang
    document.addEventListener('DOMContentLoaded', function(){
      var lang = curLang();
      document.querySelectorAll('a[href]').forEach(function(a){
        var href=a.getAttribute('href'); if(!href || href.startsWith('#') || /^https?:\/\//i.test(href)) return;
        var url=new URL(href, location.href); var sp=url.searchParams;
        if(!sp.get('lang')) sp.set('lang', lang); url.search=sp.toString();
        a.setAttribute('href', url.pathname + (url.search?('?'+url.search):'') + url.hash);
      });
    });

    // 事件封装兜底
    function sendPage(n,p){ if(window.ps&&ps.events&&ps.events.page) ps.events.page(n,p); else if(typeof plausible==='function') plausible('pageview',{props:Object.assign({page_name:n,lang:curLang()},p||{})}); }
    function sendEvt(n,p){ if(window.ps&&ps.events&&ps.events.event) ps.events.event(n,p); else if(typeof plausible==='function') plausible(n,{props:Object.assign({lang:curLang()},p||{})}); }

    function pow075(x){ return Math.pow(x,0.75); }
    function toKg(w,u){ return u==='lb' ? w*0.45359237 : w; }

    window.addEventListener('DOMContentLoaded', function(){
      sendPage('visit_feeding_page');
      var btn=document.getElementById('btn-calc');
      btn.addEventListener('click', function(){
        var w=parseFloat(document.getElementById('weight').value||'0');
        var unit=document.getElementById('unit').value;
        var kpc=parseFloat(document.getElementById('kcal-per-cup').value||'0');
        var gpc=parseFloat(document.getElementById('grams-per-cup').value||'0');
        var act=parseFloat(document.getElementById('activity').value||'1.0');
        if(!w||!kpc||!gpc) return;
        var kg=toKg(w,unit);
        var rer=70*pow075(kg);
        var mer=rer*act;
        var cups=mer/kpc;
        var grams=cups*gpc;
        document.getElementById('out-kcal').textContent = Math.round(mer);
        document.getElementById('out-cups').textContent = (Math.round(cups*100)/100).toFixed(2);
        document.getElementById('out-grams').textContent = Math.round(grams);
        document.getElementById('result').hidden=false;
        sendEvt('calc_click');
      });
    });
  })();
</script>
</body>
</html>
