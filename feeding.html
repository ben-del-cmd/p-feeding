<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feeding — Calculator</title>
  <link rel="stylesheet" href="./assets/site.css" />
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a href="./index.html" data-i18n="nav.home">Home</a>
      <a href="./feeding.html" data-i18n="nav.calculator">Calculator</a>
      <a href="./cards/transition-7.html" data-i18n="nav.transition7">7-Day Switch</a>
      <a href="./feedback.html" data-i18n="nav.feedback">Feedback</a>
      <select id="langSelect" aria-label="Language">
        <option value="en">English</option>
        <option value="zh">中文</option>
        <option value="es">Español</option>
        <option value="fr">Français</option>
      </select>
    </div>
  </nav>

  <main class="container">
    <h1 data-i18n="calculator.title">Feeding Calculator</h1>
    <p class="muted" data-i18n="legal.info_boundary">Informational only. Not medical advice.</p>

    <form id="feedForm" class="stack">
      <label>
        <span data-i18n="feeding.pet_type.label">Pet</span>
        <select id="pet">
          <option value="dog">Dog</option>
          <option value="cat">Cat</option>
        </select>
      </label>

      <label>
        <span data-i18n="feeding.weight.label">Weight</span>
        <input id="weight" type="number" step="0.01" min="0" placeholder="" data-i18n-placeholder="feeding.weight.placeholder" />
      </label>

      <label>
        <span data-i18n="feeding.unit.label">Unit</span>
        <select id="unit">
          <option value="kg" data-i18n="feeding.unit.kg">kg</option>
          <option value="lb" data-i18n="feeding.unit.lb">lb</option>
        </select>
      </label>

      <label>
        <span data-i18n="feeding.activity.label">Activity</span>
        <select id="activity">
          <option value="resting" data-i18n="feeding.activity.resting">Resting</option>
          <option value="normal" data-i18n="feeding.activity.normal">Normal</option>
          <option value="active" data-i18n="feeding.activity.active">Active</option>
        </select>
      </label>

      <label>
        <span data-i18n="feeding.kcal_per_cup.label">kcal per cup</span>
        <input id="kcalPerCup" type="number" step="1" min="1" value="350" />
      </label>

      <label>
        <span data-i18n="feeding.grams_per_cup.label">grams per cup</span>
        <input id="gramsPerCup" type="number" step="1" min="1" value="110" />
      </label>

      <button type="button" id="btnCalc" class="btn" data-i18n="feeding.calculate">Calculate</button>
      <a href="./index.html" class="muted" data-i18n="feeding.back_home">Back to Home</a>
    </form>

    <section>
      <h2 data-i18n="result.title">Result</h2>
      <div id="result" class="mono"></div>
    </section>

    <footer class="footnote">© Pet Scan</footer>
  </main>

  <script src="./assets/i18n.js"></script>
  <script src="./assets/app.js" defer></script>
  <script src="./assets/js/events.js" defer></script>
  <script>
    // 兜底初始化 + 简易计算（不依赖外部逻辑即可用）
    function kgFrom(value, unit) {
      return unit === 'lb' ? (value * 0.45359237) : value;
    }
    document.addEventListener('DOMContentLoaded', () => {
      if (window.I18N) {
        const lang = I18N.getLang ? I18N.getLang() : 'en';
        const sel = document.getElementById('langSelect');
        if (sel) { sel.value = lang; sel.onchange = (e) => I18N.setLang(e.target.value); }
        I18N.apply && I18N.apply(lang);
      }

      const $ = (id) => document.getElementById(id);
      $('btnCalc').addEventListener('click', () => {
        const w = parseFloat($('weight').value || '0');
        const unit = $('unit').value;
        const kg = kgFrom(w, unit);
        if (!kg || kg <= 0) { $('result').textContent = '--'; return; }

        // RER 公式
        const RER = 70 * Math.pow(kg, 0.75);

        // 活动系数（简化示例）
        const af = { resting: 1.0, normal: 1.6, active: 2.0 }[$('activity').value] || 1.6;
        const MER = RER * af;

        const kcalPerCup = parseFloat($('kcalPerCup').value || '350');
        const gramsPerCup = parseFloat($('gramsPerCup').value || '110');

        const cupsPerDay = kcalPerCup > 0 ? (MER / kcalPerCup) : 0;
        const gramsPerDay = gramsPerCup > 0 ? (cupsPerDay * gramsPerCup) : 0;

        $('result').textContent =
          `RER=${RER.toFixed(1)} kcal · MER≈${MER.toFixed(1)} kcal · `
          + `≈ ${cupsPerDay.toFixed(2)} cups/day · ${gramsPerDay.toFixed(0)} g/day`;
      });
    });
  </script>
</body>
</html>
