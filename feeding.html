<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-i18n="title.feeding">Feeding Calculator</title>
  <meta name="description" content="输入体重与活动水平，快速估算每日热量与喂食份量（杯/克）。">
  <link rel="canonical" href="https://ben-del-cmd.github.io/p-feeding/feeding.html">
  <link rel="icon" href="/p-feeding/cover.png?v=20250919">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ben-del-cmd.github.io/p-feeding/feeding.html">
  <meta property="og:title" content="喂食计算器｜Feeding Calculator">
  <meta property="og:description" content="输入体重与活动水平，快速估算每日热量与喂食份量（杯/克）。">
  <meta property="og:image" content="https://ben-del-cmd.github.io/p-feeding/cover.png?v=20250919">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="喂食计算器｜Feeding Calculator">
  <meta name="twitter:description" content="输入体重与活动水平，快速估算每日热量与喂食份量（杯/克）。">
  <meta name="twitter:image" content="https://ben-del-cmd.github.io/p-feeding/cover.png?v=20250919">

  <!-- Phase 1 安全基线 -->
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data:; script-src 'self' https://plausible.io 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src https://plausible.io; form-action 'self' https://github.com mailto:; base-uri 'none'; frame-ancestors 'self';">
  <meta name="theme-color" content="#0b0c0f">

  <!-- 顶部配置位（仅此处可改数值） -->
  <script>
    window.KCAL_PER_CUP = 360;  // 每杯热量
    window.GRAMS_PER_CUP = 100; // 每杯克数
  </script>

  <!-- Plausible -->
  <script defer data-domain="ben-del-cmd.github.io" src="https://plausible.io/js/script.js"></script>

  <!-- i18n（加 defer） -->
  <script defer src="/p-feeding/i18n.js?v=20250920"></script>

  <style>
    body{max-width:720px;margin:0 auto;padding:24px;line-height:1.6;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif}
    a{color:#1d4ed8}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .row>label{min-width:100px}
    input,select,button{padding:10px;border:1px solid #e5e7eb;border-radius:10px}
    button.primary{background:#0b0c0f;color:#fff;cursor:pointer}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  </style>
</head>
<body>
  <header>
    <a href="/p-feeding/" data-i18n="nav.home" rel="noopener">Home</a>
    <div>
      <button onclick="__setLang('en-US')">English</button>
      <button onclick="__setLang('es-419')">Español</button>
      <button onclick="__setLang('zh-Hans')">中文(简)</button>
      <button onclick="__setLang('fr-CA')">Français (Canada)</button>
    </div>
  </header>

  <h1 data-i18n="h1.feeding">Feeding Calculator</h1>

  <section class="card" id="calc">
    <div class="row">
      <label for="w" data-i18n="feeding.weight">Weight</label>
      <input id="w" type="number" step="0.1" min="0" placeholder="0">
      <label for="u" data-i18n="feeding.unit">Unit</label>
      <select id="u">
        <option value="kg" data-i18n="feeding.kg">Kilogram (kg)</option>
        <option value="lb" data-i18n="feeding.lb">Pound (lb)</option>
      </select>
    </div>
    <div class="row" style="margin-top:12px;">
      <label for="a" data-i18n="feeding.activity">Activity</label>
      <select id="a">
        <option value="low" data-i18n="feeding.low">Low</option>
        <option value="mid" data-i18n="feeding.mid">Medium</option>
        <option value="high" data-i18n="feeding.high">High</option>
      </select>
      <button id="go" class="primary" data-i18n="feeding.calc">Calculate</button>
    </div>
    <div id="res" style="margin-top:12px;">
      <strong data-i18n="feeding.result">Result</strong>
      <div id="out" style="margin-top:8px;"></div>
    </div>
  </section>

  <footer style="margin-top:24px;color:#6b7280;font-size:14px;">
    <span data-i18n="footer.note.feeding">Note: For reference only. Consult your vet.</span>
  </footer>

  <script>
    (function(){
      function toKg(v, unit){ return unit==='lb' ? v*0.45359237 : v; }
      function mer(k){ return 70 * Math.pow(k, 0.75); } // 近似估算
      function actCoef(a){ return a==='high'?1.8 : a==='mid'?1.4 : 1.2; }
      function format(n){ return Number.isFinite(n) ? (Math.round(n*10)/10).toString() : '-'; }

      document.getElementById('go').addEventListener('click', function(){
        const lang = document.documentElement.lang || 'en-US';
        const w = parseFloat(document.getElementById('w').value);
        const unit = document.getElementById('u').value;
        const a = document.getElementById('a').value;
        if(!(w>0)){
          document.getElementById('out').textContent = '';
          return;
        }
        const kg = toKg(w, unit);
        const kcal = mer(kg) * actCoef(a);
        const cup = kcal / (window.KCAL_PER_CUP||360);
        const g = cup * (window.GRAMS_PER_CUP||100);
        const tKcal = document.querySelector('[data-i18n="feeding.kcal.day"]').textContent;
        const tCup  = document.querySelector('[data-i18n="feeding.cup.day"]').textContent;
        const tG    = document.querySelector('[data-i18n="feeding.g.day"]').textContent;
        document.getElementById('out').innerHTML =
          '<div>'+ format(kcal) +' '+ tKcal +'</div>'+
          '<div>'+ format(cup)  +' '+ tCup  +'</div>'+
          '<div>'+ format(g)    +' '+ tG    +'</div>';
        try{ window.plausible && window.plausible('Calculate', { props: { lang, unit, a } }); }catch(e){}
      });

      // 支持从首页的示例深链（可选）
      if(location.hash.startsWith('#q=')){
        const q = decodeURIComponent(location.hash.slice(3));
        try{ window.plausible && window.plausible('DeepLink', { props: { q } }); }catch(e){}
      }
    })();
  </script>

  <!-- 隐藏文本：用于结果单位的 i18n 读取 -->
  <span style="display:none" data-i18n="feeding.kcal.day">kcal/day</span>
  <span style="display:none" data-i18n="feeding.cup.day">cup/day</span>
  <span style="display:none" data-i18n="feeding.g.day">g/day</span>
</body>
</html>
