<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="title.feedback">Feedback</title>

  <!-- Plausible（匿名统计） -->
  <script defer data-domain="ben-del-cmd.github.io" src="https://plausible.io/js/script.js"></script>

  <!-- 多语言与事件埋点 -->
  <script src="/p-feeding/i18n.js?v=20250920b" defer></script>
  <script src="/p-feeding/events.js?v=1" defer></script>

  <style>
    :root { --fg:#111; --muted:#6b7280; --bd:#e5e7eb; --bg:#fff; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--fg);
      font:16px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, PingFang SC, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    .wrap { max-width:960px; margin:0 auto; padding:24px 16px 56px; }
    h1 { font-size:clamp(28px, 4vw, 40px); margin:8px 0 24px; }
    .muted { color:var(--muted); }
    .topbar { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .pill { display:inline-flex; gap:10px; }
    .btn, button, input, select, textarea {
      font:inherit; border:1px solid var(--bd); border-radius:12px; background:#fff; color:var(--fg);
    }
    .btn { padding:8px 12px; cursor:pointer; }
    .btn-ghost { background:#fff; }
    .btn-primary { background:#111; color:#fff; border-color:#111; padding:12px 18px; border-radius:14px; cursor:pointer; }
    .btn-primary:hover { opacity:.92; }
    .card { border:1px solid var(--bd); border-radius:16px; padding:18px; background:#fff; }
    .row { margin:16px 0; }
    input, select { padding:10px 12px; min-width:260px; }
    textarea { width:100%; min-height:220px; padding:12px; resize:vertical; }
    label { display:block; margin-bottom:6px; font-weight:600; }
    a { color:#111; }
    a:hover { text-decoration:underline; }
  </style>
</head>

<!-- 关键点：仅需在 <body> 上加此属性，用于自动触发 feedback_open 事件 -->
<body data-feedback-open>
  <div class="wrap">
    <!-- 顶部 -->
    <div class="topbar">
      <a class="btn btn-ghost" href="/p-feeding/" data-i18n="nav.home">返回主页</a>
      <div class="pill">
        <button class="btn btn-ghost" onclick="window.__setLang && __setLang('en-US')">English</button>
        <button class="btn btn-ghost" onclick="window.__setLang && __setLang('es-419')">Español</button>
        <button class="btn btn-ghost" onclick="window.__setLang && __setLang('zh-Hans')">中文(简)</button>
        <button class="btn btn-ghost" onclick="window.__setLang && __setLang('fr-CA')">Français (Canada)</button>
      </div>
    </div>

    <h1 data-i18n="h1.feedback">反馈</h1>

    <!-- 表单 -->
    <div class="card">
      <div class="row">
        <label for="type" data-i18n="form.type">类型</label>
        <select id="type">
          <option value="bug" data-i18n="form.type.bug">缺陷 / Bug</option>
          <option value="feature" data-i18n="form.type.feature">功能建议</option>
        </select>
      </div>

      <div class="row">
        <label for="summary" data-i18n="form.summary">概要</label>
        <input id="summary" type="text" placeholder="" data-i18n-placeholder="form.summary.ph" />
      </div>

      <div class="row">
        <label for="details" data-i18n="form.details">详细描述</label>
        <textarea id="details" placeholder="" data-i18n-placeholder="form.details.ph"></textarea>
      </div>

      <div class="row">
        <button id="preview" class="btn-primary" data-i18n="btn.preview">预览草稿</button>
      </div>

      <div class="muted" data-i18n="footer.note.feedback" style="margin-top:6px">
        提交将跳转到 GitHub，新窗口中可再次确认后发布。
      </div>
    </div>
  </div>

  <script>
    // 简单的“预览至 GitHub Issue”逻辑
    (function () {
      var btn = document.getElementById('preview');
      btn.addEventListener('click', function () {
        var type = document.getElementById('type').value || 'bug';
        var title = (document.getElementById('summary').value || '').trim();
        var body = (document.getElementById('details').value || '').trim();

        // 最低限度的内容兜底
        if (!title) title = '[No title]';
        if (!body) body = '(No further details)';

        // 你可以换成自己仓库的 issues 新建链接
        // 这里使用通用 query：title / body
        var url = new URL('https://github.com/ben-del-cmd/ben-del-cmd.github.io/issues/new');
        var lines = [];
        lines.push('**Type**: ' + type);
        lines.push('');
        lines.push('**Summary**');
        lines.push(title);
        lines.push('');
        lines.push('**Details**');
        lines.push(body);
        lines.push('');
        // 附带当前页面来源
        try { lines.push('From: ' + location.href); } catch (e) {}

        url.searchParams.set('title', '[' + type + '] ' + title);
        url.searchParams.set('body', lines.join('\n'));

        // 打开新窗口
        window.open(url.toString(), '_blank', 'noopener,noreferrer');

        // （可选）记一次点击（如果你想分别统计“点击预览”）
        try { window.plausible && window.plausible('feedback_click'); } catch (e) {}
      });
    })();
  </script>
</body>
</html>
