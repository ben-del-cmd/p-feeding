<!doctype html>
<html lang="zh-CN">
<!-- Pet Scan · Feedback · v=20250922k | 下拉语言选择 + ?lang= 保留 + Plausible + events.js -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="feedback.metaTitle">意见反馈 · Pet Scan</title>
  <meta name="description" data-i18n="feedback.metaDesc"
        content="提交问题、建议或数据勘误，帮助我们提升命中率与解释可读性；信息性建议，非医疗。" />
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="cover.png" />

  <!-- 性能预取 -->
  <link rel="preconnect" href="https://plausible.io" crossorigin />
  <link rel="dns-prefetch" href="https://plausible.io" />

  <!-- 自动注入 Plausible：以真实 hostname 作为 data-domain -->
  <script>
    (function () {
      var domain = (location && location.hostname) ? location.hostname : 'localhost';
      var s = document.createElement('script');
      s.defer = true;
      s.setAttribute('data-domain', domain);
      s.src = 'https://plausible.io/js/script.js';
      document.head.appendChild(s);
    })();
  </script>

  <!-- 多语言（含：下拉选择器、?lang= 保留、链接补参、文案切换） -->
  <script defer src="i18n.js?v=20250922k"></script>

  <!-- 统一事件：自动上报 visit_feedback_page；下面按钮会额外触发 feedback_open / feedback_click -->
  <script type="module" src="assets/js/events.js?v=20250922k"></script>

  <style>
    :root{--bg:#0b0d12;--fg:#e5e7eb;--muted:#9ca3af;--card:#111827;--btn:#10b981;--btnfg:#0b0d12;--br:16px}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0d12,#0f172a);color:var(--fg);
         font:15px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft Yahei","Noto Sans",sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:16px;color:#fff;text-decoration:none}
    .logo-badge{width:28px;height:28px;border-radius:8px;background:#10b981;display:inline-grid;place-items:center;color:#0b0d12;font-weight:900}
    nav a{color:var(--muted);text-decoration:none;margin-left:16px}
    #langSelect{
      appearance:none;-webkit-appearance:none;-moz-appearance:none;
      padding:6px 28px 6px 10px;border:1px solid rgba(255,255,255,.15);
      background:#111827;color:#e5e7eb;border-radius:10px;font:14px/1.2 inherit;cursor:pointer;margin-left:10px
    }

    .hero{background:rgba(17,24,39,.6);border:1px solid rgba(255,255,255,.06);border-radius:var(--br);padding:28px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-size:24px}
    p.lead{margin:0 0 16px;color:#cbd5e1}

    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:var(--br);padding:16px}
    label{display:block;margin:10px 0 6px;color:#cbd5e1}
    input[type="text"],input[type="email"],select,textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:#0f172a;color:#e5e7eb
    }
    textarea{min-height:140px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;background:var(--btn);color:var(--btnfg);font-weight:700;text-decoration:none;border:0;cursor:pointer}
    .btn.sec{background:#374151;color:#e5e7eb}
    .btn.warn{background:#ef4444;color:#fff}
    .muted{color:var(--muted);font-size:12px}
    footer{margin:28px 0 8px;color:#94a3b8;font-size:12px}
    @media (max-width:880px){.row{grid-template-columns:1fr}}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <a class="logo" href="./" data-keep-lang>
        <span class="logo-badge">PS</span> <span data-i18n="brand.name">Pet Scan</span>
      </a>
      <nav class="nav" aria-label="Primary">
        <a href="./" data-i18n="nav.home" data-keep-lang>首页</a>
        <a href="feeding.html" data-i18n="nav.feeding" data-keep-lang>喂食计算器</a>
        <a href="feedback.html" data-i18n="nav.feedback" data-keep-lang>反馈</a>
        <a href="cards/transition-7.html?v=20250922h" data-i18n="nav.card" data-keep-lang>7天换粮卡</a>
        <select id="langSelect" aria-label="Language">
          <option value="en">English</option>
          <option value="zh" selected>中文</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
        </select>
      </nav>
    </header>

    <main class="hero" data-page="feedback">
      <h1 data-i18n="feedback.h1">意见反馈</h1>
      <p class="lead" data-i18n="feedback.lead">
        帮助我们提高命中率与解释可读性；导购披露保持中立。提交前不会收集个人敏感信息。
      </p>

      <section class="card" aria-labelledby="formTitle">
        <h2 id="formTitle" data-i18n="feedback.form.title">提交你的反馈</h2>

        <div class="row">
          <div>
            <label for="cat" data-i18n="feedback.form.category">类别</label>
            <select id="cat">
              <option value="bug" data-i18n="feedback.form.opt.bug">问题/报错</option>
              <option value="data" data-i18n="feedback.form.opt.data">数据勘误</option>
              <option value="suggest" data-i18n="feedback.form.opt.suggest">功能建议</option>
              <option value="other" data-i18n="feedback.form.opt.other">其它</option>
            </select>
          </div>
          <div>
            <label for="email" data-i18n="feedback.form.contact">联系邮箱（可选）</label>
            <input id="email" type="email" placeholder="name@example.com" autocomplete="email" />
          </div>
        </div>

        <label for="title" data-i18n="feedback.form.titleLabel">标题</label>
        <input id="title" type="text" placeholder="简要概述问题或建议" />

        <label for="detail" data-i18n="feedback.form.detail">详细描述</label>
        <textarea id="detail" placeholder="复现步骤、期望结果、相关产品/配方/截图链接等…"></textarea>

        <div class="row" style="margin-top:12px">
          <div>
            <button id="btnCopy" class="btn sec" data-i18n="feedback.form.copy">复制内容</button>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end">
            <button id="btnOpen"   class="btn"      data-i18n="feedback.form.openIssue">去 GitHub 提交</button>
            <a id="btnMail" class="btn warn" data-i18n="feedback.form.mailto" href="#">邮件发送</a>
          </div>
        </div>

        <p class="muted" style="margin-top:10px" data-i18n="feedback.form.hint">
          点击“复制内容”会把 JSON 文本复制到剪贴板；“去 GitHub 提交”将打开 Issues 页面，粘贴即发。
          如不方便，可点击“邮件发送”。
        </p>
      </section>

      <p class="muted" style="margin-top:14px" data-i18n="feedback.tracked">
        已启用匿名统计（Plausible），仅用于改进产品体验；事件：visit_feedback_page / feedback_open / feedback_click。
      </p>
    </main>

    <footer>
      <strong data-i18n="footer.noticeTitle">信息性提示：</strong>
      <span data-i18n="footer.noticeBody">
        本工具基于公开信息与通用标准（如 AAFCO/NRC）给出参考建议，不构成医疗或诊断意见。涉及疾病/处方需求请咨询持证兽医。
        数据可能因配方/包装更新而变化；页面已标注来源/时间戳/版本以供核验。如含推广链接，可能获得佣金（已披露）；这不影响信息的中立性。
      </span>
    </footer>
  </div>

  <script>
    // === 可定制：你仓库的 Issues 页面（或任意收集地址） ===
    const ISSUE_URL = "https://github.com/ben-del-cmd/p-feeding/issues/new";
    // ================================================

    const $ = (s) => document.querySelector(s);
    const cat = $('#cat');
    const email = $('#email');
    const title = $('#title');
    const detail = $('#detail');
    const btnCopy = $('#btnCopy');
    const btnOpen = $('#btnOpen');
    const btnMail = $('#btnMail');

    function buildPayload() {
      return {
        page: location.href,
        lang: (new URLSearchParams(location.search)).get('lang') || document.documentElement.lang || 'zh',
        category: cat.value,
        email: (email.value || '').trim(),
        title: (title.value || '').trim(),
        detail: (detail.value || '').trim(),
        ua: navigator.userAgent,
        ts: new Date().toISOString()
      };
    }

    function encodeRFC3986(str) {
      return encodeURIComponent(str).replace(/[!'()*]/g, c => '%' + c.charCodeAt(0).toString(16));
    }

    btnCopy.addEventListener('click', async () => {
      const payload = buildPayload();
      const text = JSON.stringify(payload, null, 2);
      try {
        await navigator.clipboard.writeText(text);
        btnCopy.textContent = (window.i18n && i18n.t) ? i18n.t('feedback.form.copied') : '已复制';
        setTimeout(()=>btnCopy.textContent=(window.i18n && i18n.t)? i18n.t('feedback.form.copy'):'复制内容',1600);
      } catch(e) {}
    });

    btnOpen.addEventListener('click', () => {
      const payload = buildPayload();
      const subject = `[${payload.category}] ${payload.title || 'Feedback'}`;
      const body = [
        '### Feedback JSON',
        '```json',
        JSON.stringify(payload, null, 2),
        '```',
        '',
        '### Extra context',
        '(Optional) Paste screenshots/links below.'
      ].join('\n');

      try { window.plausible && window.plausible('feedback_open'); } catch(e){}
      window.open(`${ISSUE_URL}?title=${encodeRFC3986(subject)}&body=${encodeRFC3986(body)}`, '_blank', 'noopener,noreferrer');
    });

    btnMail.addEventListener('click', (e) => {
      e.preventDefault();
      const payload = buildPayload();
      const subject = `[${payload.category}] ${payload.title || 'Feedback'}`;
      const body = JSON.stringify(payload, null, 2);
      const mailto = `mailto:?subject=${encodeRFC3986(subject)}&body=${encodeRFC3986(body)}`;
      try { window.plausible && window.plausible('feedback_click'); } catch(e){}
      location.href = mailto;
    });
  </script>
</body>
</html>
