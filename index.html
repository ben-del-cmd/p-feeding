<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Feeding — Calculator</title>
<link rel="stylesheet" href="assets/site.css?v=202509" />
<script defer src="i18n.js"></script>
<script defer src="events.js"></script>
</head>
<body>
<div class="container">
  <nav class="nav">
    <a data-keep-lang href="index.html">Home</a>
    <a data-keep-lang href="feeding.html">Calculator</a>
    <a data-keep-lang href="cards/transition-7.html">7-Day Switch</a>
    <a data-keep-lang href="feedback.html">Feedback</a>
    <div class="spacer"></div>
    <select id="lang" class="locale-select" aria-label="Language">
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="zh">中文</option>
      <option value="fr">Français</option>
    </select>
  </nav>

  <h1 class="h1">Feeding Calculator</h1>
  <p class="muted">Informational only. Not medical advice.</p>

  <div class="card">
    <div class="grid-2">
      <div>
        <label>Pet</label>
        <select id="pet">
          <option value="dog" selected>Dog</option>
          <option value="cat">Cat</option>
        </select>
      </div>

      <div>
        <label>Weight</label>
        <input id="weight" type="number" inputmode="decimal" placeholder="Enter weight" />
      </div>

      <div>
        <label>Unit</label>
        <select id="unit">
          <option value="kg" selected>kg</option>
          <option value="lb">lb</option>
        </select>
      </div>

      <div>
        <label>Activity</label>
        <select id="activity">
          <option value="rest">Resting</option>
          <option value="normal" selected>Normal</option>
          <option value="active">Active</option>
        </select>
      </div>

      <div>
        <label>kcal per cup</label>
        <input id="kcalPerCup" type="number" value="350" />
      </div>

      <div>
        <label>grams per cup</label>
        <input id="gPerCup" type="number" value="110" />
      </div>
    </div>

    <div style="margin-top:16px;display:flex;gap:12px">
      <button id="calc" class="btn">Calculate</button>
      <a class="btn secondary" data-keep-lang href="index.html">Back to Home</a>
    </div>
  </div>

  <div class="card" style="margin-top:18px">
    <h3>Result</h3>
    <div id="result" class="muted">—</div>
  </div>

  <footer>© Pet Scan</footer>
</div>

<script>
(function(){
  // 语言处理 & 保留
  const sel = document.getElementById('lang');
  const usp = new URLSearchParams(location.search);
  const lang = (usp.get('lang') || 'en').toLowerCase();
  if ([...sel.options].some(o => o.value === lang)) sel.value = lang;
  sel.addEventListener('change', () => {
    const u = new URL(location.href);
    u.searchParams.set('lang', sel.value);
    location.href = u.pathname + '?' + u.searchParams.toString();
  });
  document.querySelectorAll('a[data-keep-lang]').forEach(a => {
    const u = new URL(a.getAttribute('href'), location.origin);
    u.searchParams.set('lang', sel.value);
    a.href = u.pathname + '?' + u.searchParams.toString();
  });

  // 计算逻辑（简单版，与你之前一致的公式）
  const $ = id => document.getElementById(id);
  const pow = Math.pow;
  function toKg(w, unit){ return unit === 'lb' ? w * 0.45359237 : w; }
  function fmt(n){ return (Math.round(n * 100)/100).toString(); }

  $('calc').addEventListener('click', () => {
    const w = parseFloat($('weight').value);
    if (!w || w <= 0) { $('result').textContent = 'Please enter weight.'; return; }

    const unit = $('unit').value;
    const kg = toKg(w, unit);
    const act = $('activity').value;

    const RER = 70 * pow(kg, 0.75);
    const factor = act === 'rest' ? 1.0 : (act === 'active' ? 1.6 : 1.2);
    const MER = RER * factor;

    const kcalPerCup = Math.max(1, parseFloat($('kcalPerCup').value) || 350);
    const gPerCup = Math.max(1, parseFloat($('gPerCup').value) || 110);

    const cups = MER / kcalPerCup;
    const grams = cups * gPerCup;

    $('result').innerHTML =
      `RER: <b>${fmt(RER)}</b> kcal/day<br>` +
      `MER: <b>${fmt(MER)}</b> kcal/day<br><br>` +
      `Daily: <b>${fmt(cups)}</b> cups ≈ <b>${fmt(grams)}</b> g`;
  });
})();
</script>
</body>
</html>
