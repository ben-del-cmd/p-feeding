<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pet Scan — Home</title>
  <meta name="description" content="Turn pet food & wash labels into simple, actionable feeding & transition tips. Informational only. Not medical advice.">
  <!-- 站点样式（相对路径，避免 GitHub Pages 子路径 404） -->
  <link rel="stylesheet" href="assets/site.css?v=20250920b">
  <!-- Plausible（自动使用当前 hostname） -->
  <script defer data-domain="" src="https://plausible.io/js/script.js"></script>
  <!-- 默认语言：无 lang 时设为 en；写入 URL 与 localStorage；设置 <html lang> -->
  <script>
    (function () {
      var u = new URL(location.href);
      var cur = u.searchParams.get('lang') || localStorage.getItem('lang') || 'en';
      if (!u.searchParams.get('lang')) {
        u.searchParams.set('lang', cur);
        history.replaceState(null, '', u.toString());
      }
      document.documentElement.setAttribute('lang', cur);
      localStorage.setItem('lang', cur);
    })();
  </script>
  <!-- 站内 i18n 与事件封装（相对路径） -->
  <script src="i18n.js" defer></script>
  <script src="assets/js/events.js" defer></script>
  <style>
    /* 轻量兜底样式（不覆盖你现有的 site.css） */
    :root { --maxw: 960px; }
    body { margin:0; line-height:1.45; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; }
    header, main, footer { max-width: var(--maxw); margin: 0 auto; padding: 16px; }
    nav a { margin-right: 12px; text-decoration: none; }
    .btn { padding: 10px 14px; border-radius: 10px; border: 1px solid #ddd; display: inline-block; }
    .hero { padding: 32px 0; }
    .note { font-size: 12px; opacity: .8; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(3, minmax(0,1fr)); }
    .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; }
  </style>
</head>
<body>
<header>
  <nav aria-label="Main">
    <a id="nav-home" href="index.html" data-i18n="nav.home">Home</a>
    <a id="nav-feeding" href="feeding/feeding.html" data-i18n="nav.calculator">Calculator</a>
    <a id="nav-cards" href="cards/transition-7.html" data-i18n="nav.transition7">7-Day Switch</a>
    <a id="nav-feedback" href="feedback.html" data-i18n="nav.feedback">Feedback</a>
  </nav>
  <!-- 注意：为避免“重复语言控件”，本页不再内置语言下拉；若需控件，请由 i18n.js 挂载到指定容器 -->
  <div id="lang-slot" style="display:none"></div>
</header>

<main>
  <section class="hero">
    <h1 id="hero-title" data-i18n="home.hero.title">Turn pet food labels into simple, actionable feeding.</h1>
    <p id="hero-sub" class="note" data-i18n="home.hero.subtitle">
      Scan → unify terms (ME, GA, as-fed/DM) → personalized portions → smooth transition → reorder.
    </p>
    <p class="note" id="info-boundary" data-i18n="legal.info_boundary">Informational only. Not medical advice.</p>
    <p>
      <a class="btn" id="cta-open-calculator" href="feeding/feeding.html" data-i18n="home.cta.open_calculator">Open Calculator</a>
      <a class="btn" id="cta-view-card" href="cards/transition-7.html" data-i18n="home.cta.view_transition_card">View 7-Day Card</a>
      <a class="btn" id="cta-feedback" href="feedback.html" data-i18n="nav.feedback">Feedback</a>
    </p>
  </section>

  <section class="grid">
    <div class="card">
      <h2 data-i18n="nav.calculator">Calculator</h2>
      <p class="note" data-i18n="feeding.formula.note">RER = 70 × weight^0.75; MER = RER × activity.</p>
    </div>
    <div class="card">
      <h2 data-i18n="transition.title">7-Day Transition Card</h2>
      <p class="note">90/10 → 0/100</p>
    </div>
    <div class="card">
      <h2 data-i18n="nav.feedback">Feedback</h2>
      <p class="note" data-i18n="legal.data_use">We use anonymous analytics to improve features.</p>
    </div>
  </section>
</main>

<footer>
  <p id="footer-disclaimer" class="note" data-i18n="footer.disclaimer">
    For diet/medical questions, consult your veterinarian.
  </p>
</footer>

<!-- 运行时保障：跨页保留 ?lang + 事件上报（即使外部脚本加载较慢也能工作） -->
<script>
  (function () {
    function currentLang() {
      try {
        var u = new URL(location.href);
        return u.searchParams.get('lang') || localStorage.getItem('lang') || 'en';
      } catch (e) { return 'en'; }
    }
    // 1) 跨页保留 ?lang
    document.addEventListener('DOMContentLoaded', function () {
      var lang = currentLang();
      document.querySelectorAll('a[href]').forEach(function (a) {
        var href = a.getAttribute('href');
        if (!href || href.startsWith('#') || /^https?:\/\//i.test(href)) return; // 外链/锚点跳过
        var url = new URL(href, location.href);
        var sp = url.searchParams;
        if (!sp.get('lang')) sp.set('lang', lang);
        url.search = sp.toString();
        a.setAttribute('href', url.pathname + (url.search ? '?' + url.search : '') + url.hash);
      });
    });

    // 2) 事件上报（若 events.js 已加载则走其封装；否则直接调用 plausible）
    function sendPage(name, props) {
      if (window.ps && ps.events && typeof ps.events.page === 'function') {
        ps.events.page(name, props);
      } else if (typeof plausible === 'function') {
        plausible('pageview', { props: Object.assign({ page_name: name, lang: currentLang() }, props || {}) });
      }
    }
    function sendEvent(name, props) {
      if (window.ps && ps.events && typeof ps.events.event === 'function') {
        ps.events.event(name, props);
      } else if (typeof plausible === 'function') {
        plausible(name, { props: Object.assign({ lang: currentLang() }, props || {}) });
      }
    }

    // 页面加载与 CTA 点击
    window.addEventListener('DOMContentLoaded', function () {
      sendPage('visit_home');
      var calc = document.getElementById('cta-open-calculator');
      var card = document.getElementById('cta-view-card');
      var fb   = document.getElementById('cta-feedback');
      if (calc) calc.addEventListener('click', function(){ sendEvent('calc_cta_click'); });
      if (card) card.addEventListener('click', function(){ sendEvent('transition_card_cta'); });
      if (fb)   fb.addEventListener('click',   function(){ sendEvent('feedback_open'); });
    });
  })();
</script>
</body>
</html>
