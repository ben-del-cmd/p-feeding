<!doctype html>
<html lang="zh-CN">
<!-- Pet Scan · 7-day Transition Card · v=20250922k | 下拉语言选择 + ?lang= 保留 + Plausible + events.js -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="card.metaTitle">7 天换粮卡 · Pet Scan</title>
  <meta name="description" data-i18n="card.metaDesc"
        content="经典 90/10 → 0/100 的 7 日过渡表；依据两款食品能量密度与杯重自动换算，每日给出旧粮/新粮克数与杯数；信息性建议，非医疗。" />
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="../cover.png" />

  <!-- 性能预取 -->
  <link rel="preconnect" href="https://plausible.io" crossorigin />
  <link rel="dns-prefetch" href="https://plausible.io" />

  <!-- 自动注入 Plausible：以真实 hostname 作为 data-domain -->
  <script>
    (function () {
      var domain = (location && location.hostname) ? location.hostname : 'localhost';
      var s = document.createElement('script');
      s.defer = true;
      s.setAttribute('data-domain', domain);
      s.src = 'https://plausible.io/js/script.js';
      document.head.appendChild(s);
    })();
  </script>

  <!-- 多语言（含：下拉选择器、?lang= 保留、链接补参、文案切换） -->
  <script defer src="../i18n.js?v=20250922k"></script>

  <!-- 统一事件：根据 data-page 自动上报 visit_*（此页为 visit_card_page） -->
  <script type="module" src="../assets/js/events.js?v=20250922k"></script>

  <style>
    :root{--bg:#0b0d12;--fg:#e5e7eb;--muted:#9ca3af;--card:#111827;--btn:#10b981;--btnfg:#0b0d12;--br:16px}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0d12,#0f172a);color:var(--fg);
         font:15px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft Yahei","Noto Sans",sans-serif}
    .wrap{max-width:1080px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:16px;color:#fff;text-decoration:none}
    .logo-badge{width:28px;height:28px;border-radius:8px;background:#10b981;display:inline-grid;place-items:center;color:#0b0d12;font-weight:900}
    nav a{color:var(--muted);text-decoration:none;margin-left:16px}
    #langSelect{
      appearance:none;-webkit-appearance:none;-moz-appearance:none;
      padding:6px 28px 6px 10px;border:1px solid rgba(255,255,255,.15);
      background:#111827;color:#e5e7eb;border-radius:10px;font:14px/1.2 inherit;cursor:pointer;margin-left:10px
    }

    .hero{background:rgba(17,24,39,.6);border:1px solid rgba(255,255,255,.06);border-radius:var(--br);padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-size:24px}
    p.lead{margin:0 0 16px;color:#cbd5e1}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:var(--br);padding:16px}
    label{display:block;margin:10px 0 6px;color:#cbd5e1}
    input[type="number"],input[type="text"],select{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:#0f172a;color:#e5e7eb
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;background:var(--btn);color:var(--btnfg);font-weight:700;text-decoration:none;border:0;cursor:pointer}
    .btn.sec{background:#374151;color:#e5e7eb}
    .muted{color:var(--muted);font-size:12px}
    table{width:100%;border-collapse:collapse;border-spacing:0;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:right}
    th:first-child,td:first-child{text-align:left}
    tr:last-child td{border-bottom:0}
    .kicker{font-size:12px;color:#9ca3af;margin-bottom:8px}
    footer{margin:28px 0 8px;color:#94a3b8;font-size:12px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    @media print{
      body{background:#fff;color:#000}
      .hero,.card{background:#fff;border-color:#ddd;box-shadow:none}
      .btn,.nav-only{display:none!important}
      #langSelect{display:none!important}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <a class="logo" href="../" data-keep-lang>
        <span class="logo-badge">PS</span> <span data-i18n="brand.name">Pet Scan</span>
      </a>
      <nav class="nav" aria-label="Primary">
        <a href="../" data-i18n="nav.home" data-keep-lang>首页</a>
        <a href="../feeding.html" data-i18n="nav.feeding" data-keep-lang>喂食计算器</a>
        <a href="../feedback.html" data-i18n="nav.feedback" data-keep-lang>反馈</a>
        <select id="langSelect" aria-label="Language">
          <option value="en">English</option>
          <option value="zh" selected>中文</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
        </select>
      </nav>
    </header>

    <main class="hero" data-page="card">
      <h1 data-i18n="card.h1">7 天换粮卡</h1>
      <p class="lead" data-i18n="card.lead">
        经典 90/10 → 0/100 过渡；按两种食品的能量密度与 g/杯自动换算每日克数与杯数。<strong>信息性建议，非医疗。</strong>
      </p>

      <div class="grid">
        <!-- 输入参数 -->
        <section class="card" aria-labelledby="inputTitle">
          <div class="kicker" data-i18n="card.input.kicker">输入参数</div>
          <h2 id="inputTitle" class="nav-only" data-i18n="card.input.title">输入参数</h2>

          <div class="row">
            <div>
              <label for="kcal" data-i18n="card.input.kcal">每天用于正餐（kcal/天）</label>
              <input id="kcal" type="number" min="1" step="1" value="600" />
            </div>
            <div>
              <label for="gpercup" data-i18n="card.input.gpercup">克/杯（g per cup）</label>
              <input id="gpercup" type="number" min="1" step="1" value="110" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="oldED" data-i18n="card.input.oldED">旧粮能量密度（kcal/100 g）</label>
              <input id="oldED" type="number" min="1" step="1" value="350" />
            </div>
            <div>
              <label for="newED" data-i18n="card.input.newED">新粮能量密度（kcal/100 g）</label>
              <input id="newED" type="number" min="1" step="1" value="380" />
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
            <button id="btnMake" class="btn" data-i18n="card.input.make">生成换粮卡</button>
            <button id="btnPrint" class="btn sec" data-i18n="card.input.print">打印/保存 PDF</button>
          </div>

          <p class="muted" style="margin-top:8px" data-i18n="card.input.hint">
            建议先在喂食计算器得到每日 MER 正餐能量（kcal/天），再回到本页。
          </p>
        </section>

        <!-- 输出表 -->
        <section class="card" aria-labelledby="tableTitle">
          <div class="kicker" data-i18n="card.table.kicker">7 日过渡表</div>
          <h2 id="tableTitle" class="nav-only" data-i18n="card.table.title">7 日过渡表</h2>

          <table aria-describedby="tableTitle">
            <thead>
              <tr>
                <th data-i18n="card.table.day">天数</th>
                <th data-i18n="card.table.ratio">配比（旧/新）</th>
                <th data-i18n="card.table.old">旧粮（g/天）</th>
                <th data-i18n="card.table.new">新粮（g/天）</th>
                <th data-i18n="card.table.total">总量（g/天）</th>
                <th data-i18n="card.table.cups">约（杯/天）</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <!-- JS 填充 -->
            </tbody>
          </table>

          <p class="muted" style="margin-top:10px" data-i18n="card.table.note">
            说明：克数根据热量换算，计算公式为 <em>kcal ÷ (kcal/100 g) × 100</em>；杯数=总克数 ÷ 每杯克重。若有浪费/加湿，建议分别按自用秤重换算。
          </p>
        </section>
      </div>

      <p class="muted" style="margin-top:14px" data-i18n="card.tracked">
        已启用匿名统计（Plausible），仅用于改进产品体验；事件：visit_card_page / calc_click。
      </p>
    </main>

    <footer>
      <strong data-i18n="footer.noticeTitle">信息性提示：</strong>
      <span data-i18n="footer.noticeBody">
        本工具基于公开信息与通用标准（如 AAFCO/NRC）给出参考建议，不构成医疗或诊断意见。涉及疾病/处方需求请咨询持证兽医。
        数据可能因配方/包装更新而变化；页面已标注来源/时间戳/版本以供核验。如含推广链接，可能获得佣金（已披露）；这不影响信息的中立性。
      </span>
    </footer>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const kcal = $('#kcal');
    const gpercup = $('#gpercup');
    const oldED = $('#oldED');
    const newED = $('#newED');
    const btnMake = $('#btnMake');
    const btnPrint = $('#btnPrint');
    const tbody = $('#tbody');

    // 过渡配比：旧/新（百分比）
    const SCHEDULE = [
      [90,10],[80,20],[70,30],[60,40],[50,50],[30,70],[0,100]
    ];

    function round(n){ return Math.round((+n || 0)); }
    function fmt(n){ return isFinite(n)? String(n) : '—'; }

    function make() {
      const kcalDay = +kcal.value || 0;
      const cupG = +gpercup.value || 110;

      const gOld100 = +oldED.value || 0; // kcal/100g
      const gNew100 = +newED.value || 0;

      // 按热量密度换算成克数（如果密度无效，则相应列为 —）
      function gramsByEnergy(kcalPart, density100){
        if (!density100) return NaN;
        return (kcalPart / density100) * 100;
      }

      let html = '';
      SCHEDULE.forEach((pair, i) => {
        const [po, pn] = pair; // % old/new
        const kcalOld = kcalDay * po / 100;
        const kcalNew = kcalDay * pn / 100;

        const gOld = gramsByEnergy(kcalOld, gOld100);
        const gNew = gramsByEnergy(kcalNew, gNew100);
        const gTotal = (isFinite(gOld)?gOld:0) + (isFinite(gNew)?gNew:0);
        const cups = cupG>0 ? gTotal / cupG : NaN;

        html += `<tr>
          <td>${i+1}</td>
          <td>${po}% / ${pn}%</td>
          <td>${fmt(round(gOld))}</td>
          <td>${fmt(round(gNew))}</td>
          <td>${fmt(round(gTotal))}</td>
          <td>${isFinite(cups)? (Math.round(cups*10)/10) : '—'}</td>
        </tr>`;
      });
      tbody.innerHTML = html;
    }

    btnMake.addEventListener('click', () => {
      make();
      try { window.plausible && window.plausible('calc_click'); } catch(e){}
    });

    btnPrint.addEventListener('click', () => {
      window.print();
    });

    // 首次渲染
    make();
  </script>
</body>
</html>
