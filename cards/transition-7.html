<!doctype html>
<html lang="zh-CN">
<!-- Pet Scan · 7-Day Transition Card · v20250922i -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pet Scan · 7 天换粮卡</title>
  <meta name="description" content="7 天换粮过渡卡，按能量密度自动换算克数与杯数；信息性建议（非医疗）。" />
  <meta name="robots" content="index,follow" />

  <link rel="preconnect" href="https://plausible.io" crossorigin />
  <link rel="dns-prefetch" href="https://plausible.io" />

  <!-- Plausible：按当前真实域名自动注入 -->
  <script>
  (function(){
    var domain = (location && location.hostname) ? location.hostname : 'localhost';
    var s = document.createElement('script'); s.defer = true;
    s.setAttribute('data-domain', domain); s.src = 'https://plausible.io/js/script.js';
    document.head.appendChild(s);
  })();
  </script>

  <!-- 复用现有 i18n 与埋点 -->
  <script defer src="../i18n.js?v=20250922i"></script>
  <script type="module" src="../assets/js/events.js?v=20250922i"></script>

  <style>
    :root{--bg:#0b0d12;--fg:#e5e7eb;--muted:#9ca3af;--card:#111827;--btn:#10b981;--btnfg:#0b0d12;--outline:rgba(255,255,255,.08);--br:16px}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0d12,#0f172a);color:var(--fg);font:15px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft Yahei","Noto Sans",sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:16px;color:#fff;text-decoration:none}
    .logo-badge{width:28px;height:28px;border-radius:8px;background:#10b981;display:inline-grid;place-items:center;color:#0b0d12;font-weight:900}
    .nav a{color:var(--muted);text-decoration:none;margin-left:16px}
    .lang{margin-left:16px;padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:transparent;color:#cbd5e1;cursor:pointer}

    .page{background:rgba(17,24,39,.6);border:1px solid var(--outline);border-radius:var(--br);padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 6px;font-size:22px}
    p.lead{margin:0 0 16px;color:#cbd5e1}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:var(--card);border:1px solid var(--outline);border-radius:14px;padding:16px}
    label{display:block;margin:10px 0 6px;color:#cbd5e1}
    input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--outline);background:#0f172a;color:#e5e7eb}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{display:inline-block;padding:12px 16px;border-radius:12px;background:var(--btn);color:var(--btnfg);font-weight:800;border:0;cursor:pointer}
    .btn.sec{background:#374151;color:#e5e7eb}
    .muted{color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid var(--outline);padding:8px;border-radius:8px}
    th{text-align:left;color:#cbd5e1;background:rgba(255,255,255,.02)}
    .note{margin-top:12px;color:#94a3b8;font-size:13px}
    footer{margin:28px 0 8px;color:#94a3b8;font-size:12px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    @media print {
      body{background:#fff;color:#000}
      .wrap{max-width:100%;padding:0}
      header,footer{display:none}
      .page{border:none;box-shadow:none}
      .card{background:#fff;border-color:#ddd}
      th,td{border-color:#ccc;color:#000}
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <a class="logo" href="../">
      <span class="logo-badge">PS</span> <span>Pet Scan</span>
    </a>
    <nav class="nav">
      <a href="../"><span data-i18n="nav_home">首页</span></a>
      <a href="../feeding.html"><span data-i18n="nav_feeding">喂食计算器</span></a>
      <a href="../feedback.html"><span data-i18n="nav_feedback">反馈</span></a>
      <!-- 语言下拉：由 i18n.js v20250922i 自动替换生成 -->
      <button id="langToggle" class="lang" type="button">EN</button>
    </nav>
  </header>

  <main class="page" data-page="card7">
    <h1>7 天换粮卡</h1>
    <p class="lead">经典 90/10 → 0/100 过渡；按两种食品的能量密度与 g/杯自动换算出每日克数与杯数。<strong>信息性建议，非医疗。</strong></p>

    <div class="grid">
      <!-- 左：输入 -->
      <section class="card">
        <h3>输入参数</h3>
        <div class="row">
          <div>
            <label for="mealKcal">每天用于正餐（kcal/天）</label>
            <input id="mealKcal" type="number" step="1" placeholder="例如：按计算器 MER 扣除零食后的数值" />
          </div>
          <div>
            <label for="gPerCup">克/杯（g per cup）</label>
            <input id="gPerCup" type="number" step="1" value="110" />
          </div>
        </div>

        <h4 style="margin-top:10px">能量密度（kcal / 100 g）</h4>
        <div class="row">
          <div>
            <label for="kcal100A">食物 A</label>
            <input id="kcal100A" type="number" step="1" placeholder="例如 380" />
          </div>
          <div>
            <label for="kcal100B">食物 B</label>
            <input id="kcal100B" type="number" step="1" placeholder="例如 320" />
          </div>
        </div>

        <div style="margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button class="btn" id="genBtn">生成换粮卡</button>
          <button class="btn sec" id="printBtn">打印/保存 PDF</button>
          <span class="muted">建议先在 <a href="../feeding.html">计算器</a> 得到 MER 正餐能量，再回填本页。</span>
        </div>
      </section>

      <!-- 右：换粮表 -->
      <section class="card">
        <h3>7 日过渡表</h3>
        <div id="emptyHint" class="muted">填写左侧参数后点击“生成换粮卡”。</div>

        <div id="cardArea" style="display:none">
          <table>
            <thead>
              <tr>
                <th>日次</th>
                <th>%A</th>
                <th>%B</th>
                <th>A 克/天</th>
                <th>B 克/天</th>
                <th>合计 克/天</th>
                <th>A 杯/天</th>
                <th>B 杯/天</th>
                <th>合计 杯/天</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>

          <div class="note">
            <div>口径：维持每日用于正餐的总能量不变；按 A/B 能量密度与 90/10→0/100 比例换算克数与杯数。</div>
            <div id="metaLine" class="muted" style="margin-top:6px"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="i18n-footer">© <span class="mono">Pet Scan</span> · <span class="muted" data-i18n="footer_hint">信息性建议（非医疗）</span></div>
  </footer>
</div>

<script>
  const $ = (id)=>document.getElementById(id);
  const pct = [90,80,70,60,50,30,0]; // A 的百分比；B=100-A

  function round(x, n=2){ const m=Math.pow(10,n); return Math.round((x+m*1e-12)*m)/m; }
  function safeNum(x){ const v = parseFloat(x); return (isFinite(v)&&!isNaN(v))? v : 0; }

  function gen(){
    const meal = safeNum($('mealKcal').value);
    const gPerCup = safeNum($('gPerCup').value) || 110;
    const kA = safeNum($('kcal100A').value);
    const kB = safeNum($('kcal100B').value);

    if(meal<=0 || kA<=0 || kB<=0){
      $('emptyHint').textContent = '请先完整填写：用于正餐的能量、A/B 能量密度。';
      $('cardArea').style.display = 'none';
      $('emptyHint').style.display = 'block';
      return;
    }
    const ka = kA/100, kb = kB/100;

    const tb = $('tbody');
    tb.innerHTML = '';
    pct.forEach((pa, i)=>{
      const pb = 100 - pa;
      const kcalA = meal * (pa/100);
      const kcalB = meal * (pb/100);
      const gA = kcalA / ka;
      const gB = kcalB / kb;
      const gT = gA + gB;
      const cA = gPerCup>0 ? gA / gPerCup : 0;
      const cB = gPerCup>0 ? gB / gPerCup : 0;
      const cT = gPerCup>0 ? gT / gPerCup : 0;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${pa}%</td>
        <td>${pb}%</td>
        <td class="mono">${round(gA,0)}</td>
        <td class="mono">${round(gB,0)}</td>
        <td class="mono">${round(gT,0)}</td>
        <td class="mono">${round(cA,2)}</td>
        <td class="mono">${round(cB,2)}</td>
        <td class="mono">${round(cT,2)}</td>
      `;
      tb.appendChild(tr);
    });

    const ts = new Date().toISOString().replace('T',' ').replace('Z',' UTC');
    $('metaLine').textContent = '时间戳 ' + ts + '；版本 v20250922i。';
    $('emptyHint').style.display = 'none';
    $('cardArea').style.display = 'block';

    try { window.plausible && window.plausible('card7_generate', { props:{ has_meal: meal>0 } }); } catch(e){}
  }

  $('genBtn').addEventListener('click', gen);
  $('printBtn').addEventListener('click', ()=>{ window.print(); });

  // 页面打开事件（与其他页面一致）
  try { window.plausible && window.plausible('visit_card7'); } catch(e){}
</script>
</body>
</html>
